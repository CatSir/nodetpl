<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title></title>
<script src="http://www.nodetpl.com/static/js/lib/nodetpl.min.js"></script>
</head>
<body>
<div id="result"></div>

<script src="http://www.nodetpl.com/static/js/lib/jquery-1.10.2.js"></script>
<script>
var data = {
  admin: true,
  list: [{
    user: 'zhangsan'
  }, {
    user: 'lisi'
  }, {
    user: 'wangwu'
  }]
};
var content = [
  '{{if admin}}',
  '  <p>admin</p>',
  '{{else if code > 0}}',
  '  <p>master</p>',
  '{{else}}',
  '  <p>error!</p>',
  '{{/if}}',
  '<ul>',
  '  {{each list as value index}}',
  '    <li>{{index}} - {{value.user}}</li>',
  '  {{/each}}',
  '  {{each list}}',
  '    <li>{{$index}} - {{$value.user}}</li>',
  '  {{/each}}',
  '</ul>'
].join('\n');
nodetpl.config({
  strict: false,
  openTag: '{{',
  closeTag: '}}',
  map: function(str) {
    // if
    str = str.replace(/ *else if +(.*)/g, '} else if($1) {').replace(/ *if +(.*)/g, 'if($1) {').replace(/ *else *$/g, '} else {').replace(/ *\/if/g, '}');
    // each list as value index
    str = str.replace(/ *each ([^ ]+) as ([^ ]+) *([^ ]+)?/g, function(all, arr, value, index) {
      return arr + '.forEach(function(' + value + (index ? ',' : '') + (index || '') + ') {';
    }).replace(/ *each ([^ ]+)/g, function(all, arr) {
      return arr + '.forEach(function($value, $index) {';
    }).replace(/\/each/g, '});');
    // value
    str = str.replace(/^([^\s{}]+)$/g, '=$1');
    return str;
  }
});
nodetpl.render(content, data, function(d) {
  $('#result').html(d);
  console.log(d);
});
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?55310397b78e4d3793e8b32711e7c487";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>