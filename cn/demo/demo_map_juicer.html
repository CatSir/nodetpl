<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title></title>
<script src="http://www.nodetpl.com/static/js/lib/nodetpl.min.js"></script>
</head>
<body>
<div id="result"></div>

<script src="http://www.nodetpl.com/static/js/lib/jquery-1.10.2.js"></script>
<script>
var data = {
  list: [
    {name:' guokai', show: true},
    {name:' benben', show: false},
    {name:' dierbaby', show: true}
  ],
  blah: [
    {num: 1},
    {num: 2},
    {num: 3, inner:[
      {'time': '15:00'},
      {'time': '16:00'},
      {'time': '17:00'},
      {'time': '18:00'}
    ]},
    {num: 4}
  ]
};
var content = [
  '<ul>',
  '  {@each list as it,index}',
  '    <li>${it.name} (index: ${index})</li>',
  '  {@/each}',
  '  {@each blah as it}',
  '    <li>',
  '      num: ${it.num} <br />',
  '      {@if it.num==3}',
  '        {@each it.inner as it2}',
  '          ${it2.time} <br />',
  '        {@/each}',
  '      {@else if it.num==4}',
  '        ${it.num}',
  '      {@/if}',
  '    </li>',
  '  {@/each}',
  '</ul>'
].join('\n');
nodetpl.config({
  strict: false,
  openTag: '{',
  closeTag: '}',
  map: function(str) {
    console.log(str);
    // {@each} ... {@/each}
    str = str.replace(/@each ([^ ]+) as ([^ ,]+)([, ]?)([^ ]+)?/g, function(all, arr, value, dot, index) {
      return arr + '.forEach(function(' + value + (dot || '') + (index || '') + ') {';
    }).replace(/@\/each/g, '});');
    // {@if} ... {@else if} ... {@else} ... {@/if}
    str = str.replace(/@if (.*)/g, 'if($1){').replace(/@else if (.*)/g, '} else if($1){').replace(/@\/if/g, '}');
    // {#
    str = str.replace(/#.*/g, '');
    return str;
  },
  beforeCompile: function(html) {
    // ${...} => {=...}
    // $${...} => {==...}
    return html.replace(/\$\{/g, '{=').replace(/\${2}\{/g, '{==');
  }
});
nodetpl.render(content, data, function(d) {
  $('#result').html(d);
  console.log(d);
});
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?55310397b78e4d3793e8b32711e7c487";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>