<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title></title>
<script src="http://www.nodetpl.com/static/js/lib/nodetpl.min.js"></script>
</head>
<body>
<div id="result"></div>

<script src="http://www.nodetpl.com/static/js/lib/jquery-1.10.2.js"></script>
<script>
nodetpl.config({
  strict: false,
  map: function(str) {
    // foreach => arr.forEach
    str = str
      .replace(/foreach\s*\(\s*(\$array)\s+as\s+(\$key)\s*=>\s*(\$value)\s*\):/g, function(all, arr, key, value) {
        return arr.replace(/^\$/g, '') + '.forEach(function(' + value.replace(/^\$/g, '') + ', ' + key.replace(/^\$/g, '') + ') {';
      })
      .replace(/endforeach/g, '});');
    // for
    str = str
      .replace(/for\s*\(\s*([^;]+)(.*)\):/g, function(all, vars, conditions) {
        return 'for(var ' + vars.replace(/\$/g, '') + conditions.replace(/\$/g, '') + ') {';
      })
      .replace(/endfor/g, '}');
    // if
    str = str
      .replace(/((?:else\s+)?if)\s*\((.*)\):/g, function(all, elseif, conditions) {
        return elseif + '(' + conditions.replace(/\$/g, '') + ') {';
      })
      .replace(/endif/g, '}');
    // $name => name
    str = str.replace(/^\s*=\s*\$/g, '=');
    return str;
  }
});
// other language
var content = '<div>\n' +
'  <?foreach ($array as $key => $value):?>\n' +
'    hello, <?=$key?> <?=$value?>\n' +
'  <?endforeach?>\n' +
'  <?for($i=0; $i<=10; $i++):?>\n' +
'    hello, <?=$i?>\n' +
'  <?endfor?>\n' +
'  <?if($age < 20):?>\n' +
'    hello, young man.\n' +
'  <?endfor?>\n' +
'</div>';

nodetpl.render(content, {
  array: ['Tom', 'Lily', 'John'],
  age: 18
}, function(d) {
  $('#result').html(d);
  console.log(d);
});
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?55310397b78e4d3793e8b32711e7c487";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>